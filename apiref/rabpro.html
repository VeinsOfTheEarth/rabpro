<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>rabpro &mdash; rabpro  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="API Reference" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> rabpro
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Setup:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configure/index.html">Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/notebooks/downloading_data.html">Downloading data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/notebooks/basic_example.html">Basic example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/notebooks/multiple_basins.html">Multiple basins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/notebooks/basin_stats.html">Basin stats examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellanea:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/index.html">Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/index.html">Citing rabpro</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">API Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">rabpro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#rabpro-core-py">rabpro (core.py)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-utility-functions-data-utils-py">Data utility functions (data_utils.py)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#elevation-profile-computation-elev-profile-py">Elevation profile computation (elev_profile.py)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#merit-utilities-merit-utils-py">MERIT utilities (merit_utils.py)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basin-statistics-basin-stats-py">Basin statistics (basin_stats.py)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basin-delineation-basins-py">Basin delineation (basins.py)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#utility-functions-utils-py">Utility functions (utils.py)</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">rabpro</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">API Reference</a> &raquo;</li>
      <li>rabpro</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="rabpro">
<span id="id1"></span><h1>rabpro<a class="headerlink" href="#rabpro" title="Permalink to this headline"></a></h1>
<span class="target" id="module-rabpro.core"></span><section id="rabpro-core-py">
<h2>rabpro (core.py)<a class="headerlink" href="#rabpro-core-py" title="Permalink to this headline"></a></h2>
<p>Class for running rabpro commands on your data.</p>
<dl class="py class">
<dt class="sig sig-object py" id="rabpro.core.profiler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">rabpro.core.</span></span><span class="sig-name descname"><span class="pre">profiler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">coords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'unnamed'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path_results</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_gee_metadata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.core.profiler" title="Permalink to this definition"></a></dt>
<dd><p>The profiler class organizes data and methods for using rabpro. This is
a parent class to the centerline and point classes which inherit profiler
methods and attributes.</p>
<dl class="field-list simple">
<dt class="field-odd">Attributes</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>coords</strong><span class="classifier">tuple OR list OR str OR GeoDataFrame</span></dt><dd><p>Coordinates of point(s) to delineate. A single point may be provided as
a (lat, lon) tuple. Point(s) may also be provided via a
shapefile or .csv file. If provided as .csv file, the columns must be
labeled ‘latitude’ and ‘longitude’. If a shapefile path is provided, the
shapefile may also contain columns for widths and/or along-valley
distances. These columns should have “width” and “distance” somewhere in
their column names, respectively, in order for rabpro to exploit them.</p>
</dd>
<dt><strong>da</strong><span class="classifier">number</span></dt><dd><p>Represents the drainage area in square kilometers of the downstream-most
point in the provided coords.</p>
</dd>
<dt><strong>name</strong><span class="classifier">str</span></dt><dd><p>Name of location/river, used for filename saving purposes only.</p>
</dd>
<dt><strong>verbose</strong><span class="classifier">bool</span></dt><dd><p>If True, will print updates as processing progresses.</p>
</dd>
<dt><strong>update_gee_metadata</strong><span class="classifier">bool</span></dt><dd><p>If True, will attempt to download the latest GEE Data Catalog metadata.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Methods</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 31%" />
<col style="width: 69%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>delineate_basin:</strong></p></td>
<td><p>Computes the watersheds for each lat/lon pair</p></td>
</tr>
<tr class="row-even"><td><p><strong>elev_profile:</strong></p></td>
<td><p>Compute the elevation profile</p></td>
</tr>
<tr class="row-odd"><td><p><strong>basin_stats:</strong></p></td>
<td><p>Computes watershed statistics</p></td>
</tr>
<tr class="row-even"><td><p><strong>export:</strong></p></td>
<td><p>Exports computed data</p></td>
</tr>
</tbody>
</table>
<dl class="py method">
<dt class="sig sig-object py" id="rabpro.core.profiler.basin_stats">
<span class="sig-name descname"><span class="pre">basin_stats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datasets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reducer_funcs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">folder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.core.profiler.basin_stats" title="Permalink to this definition"></a></dt>
<dd><p>Computes watershed statistics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>datasets</strong><span class="classifier">list of Dataset</span></dt><dd><p>Datasets to compute stats over. See the subbasin_stats.Dataset class</p>
</dd>
<dt><strong>reducer_funcs</strong><span class="classifier">list of functions</span></dt><dd><p>List of functions to apply to each feature over each dataset. Each
function should take in an ee.Feature() object. For example, this is
how the function and header are applied on a feature:
feature.set(f.__name__, function(feature))</p>
</dd>
<dt><strong>folder</strong><span class="classifier">str</span></dt><dd><p>Google Drive folder to store results in</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="rabpro.core.profiler.delineate_basin">
<span class="sig-name descname"><span class="pre">delineate_basin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">search_radius</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">map_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_merit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_hydrobasins</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.core.profiler.delineate_basin" title="Permalink to this definition"></a></dt>
<dd><p>Computes the watersheds for each lat/lon pair and adds their
drainage areas to the self.gdf <cite>GeoDataFrame</cite>.</p>
<p>There are two methods available for delineating basins: HydroBASINS and
MERIT. HydroBASINS is appropriate for large basins (1000 km^2 and
larger), and MERIT can provide more detailed basin delineations for
smaller basins. The method used depends on the size of the basin, which
is interpreted via the provided drainage area. If no drainage area was
provided, HydroBASINS will be used. Otherwise, if the provided drainage
area is less than 1000 km^2, MERIT will be used. MERIT may also be forced
for larger basins using the ‘force_merit’ argument when instantiating
the profiler.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>search_radius</strong><span class="classifier">numeric, optional</span></dt><dd><p>in meters, by default None</p>
</dd>
<dt><strong>map_only</strong><span class="classifier">bool, optional</span></dt><dd><p>If we only want to map the point and not delineate the basin, by
default False</p>
</dd>
<dt><strong>force_merit</strong><span class="classifier">bool, optional</span></dt><dd><p>Forces the use of MERIT to delineate basins.</p>
</dd>
<dt><strong>force_hydrobasins</strong><span class="classifier">bool, optional</span></dt><dd><p>Forces the use of HydroBASINS to delineate basins.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Warns</dt>
<dd class="field-even"><dl class="simple">
<dt>UserWarning</dt><dd><p>If no drainage area provided</p>
</dd>
<dt>RuntimeWarning</dt><dd><p>If MERIT or HydroBasins data is not available, or other issues</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="rabpro.core.profiler.elev_profile">
<span class="sig-name descname"><span class="pre">elev_profile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dist_to_walk_km</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.core.profiler.elev_profile" title="Permalink to this definition"></a></dt>
<dd><p>Compute the elevation profile. The profile is computed such that the
provided coordinate is the centerpoint (check if this is true).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>dist_to_walk_km</strong><span class="classifier">numeric</span></dt><dd><p>The distance to trace the elevation profile from the provided
point. This distance applies to upstream and downstream–i.e. the
total profile distance is twice this value. If not specified,
will be automatically computed as 10 channel widths from provided
DA value if not specified OR 5 km, whichever is larger.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="rabpro.core.profiler.export">
<span class="sig-name descname"><span class="pre">export</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">what</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'all'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.core.profiler.export" title="Permalink to this definition"></a></dt>
<dd><p>Exports data computed by rapbro.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>what</strong><span class="classifier">list, optional</span></dt><dd><p>Which data should be exported? Choose from
‘all’ - all computed data
‘flowline’ - flowline json is exported with elevation and distance attributes
‘watershed’ - watershed polygon
The default is ‘all’.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<span class="target" id="module-rabpro.data_utils"></span><section id="data-utility-functions-data-utils-py">
<h2>Data utility functions (data_utils.py)<a class="headerlink" href="#data-utility-functions-data-utils-py" title="Permalink to this headline"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="rabpro.data_utils.does_hydrobasins_exist">
<span class="sig-prename descclassname"><span class="pre">rabpro.data_utils.</span></span><span class="sig-name descname"><span class="pre">does_hydrobasins_exist</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datapaths</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.data_utils.does_hydrobasins_exist" title="Permalink to this definition"></a></dt>
<dd><p>Checks if level 1 and level 12 HydroBasins data are available.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.data_utils.does_merit_exist">
<span class="sig-prename descclassname"><span class="pre">rabpro.data_utils.</span></span><span class="sig-name descname"><span class="pre">does_merit_exist</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datapaths</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.data_utils.does_merit_exist" title="Permalink to this definition"></a></dt>
<dd><p>Checks if any MERIT tiles are in the MERIT data directories. Also checks
if the vrts have been built. Returns the number of MERIT layers that have
data (maximum of 4).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.data_utils.download_hydrobasins">
<span class="sig-prename descclassname"><span class="pre">rabpro.data_utils.</span></span><span class="sig-name descname"><span class="pre">download_hydrobasins</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datapath</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proxy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.data_utils.download_hydrobasins" title="Permalink to this definition"></a></dt>
<dd><p>Downloads HydroBASINS to the proper location, then unzips and deletes
zip file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>datapath</strong><span class="classifier">str or Path, optional</span></dt><dd><p>Directory to download and unzip HydroBasins data into; does not include
filename. If None, will use the rabpro default.</p>
</dd>
<dt><strong>proxy</strong><span class="classifier">str, optional</span></dt><dd><p>Pass a proxy to requests.get, by default None</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rabpro</span> <span class="kn">import</span> <span class="n">data_utils</span>
<span class="n">data_utils</span><span class="o">.</span><span class="n">hydrobasins</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.data_utils.download_merit_hydro">
<span class="sig-prename descclassname"><span class="pre">rabpro.data_utils.</span></span><span class="sig-name descname"><span class="pre">download_merit_hydro</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">merit_tile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">username</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">password</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proxy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.data_utils.download_merit_hydro" title="Permalink to this definition"></a></dt>
<dd><p>Downloads the four required rabpro layers for a given MERIT-Hydro
30 degree x 30 degree tile. Each tile contains 5 degree x 5 degree geotiffs.
Data are downloaded and untarred into the location and filestructure rabpro
expects. Virtual rasters are rebuilt after downloading this data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>merit_tile</strong><span class="classifier">str</span></dt><dd><p>The MERIT-Hydro tile to fetch. e.g. “n45w100”</p>
</dd>
<dt><strong>username</strong><span class="classifier">str</span></dt><dd><p>The MERIT-Hydro username (must request from MERIT-Hydro developers).</p>
</dd>
<dt><strong>password</strong><span class="classifier">str</span></dt><dd><p>The MERIT-Hydro password (must request from MERIT-Hydro developers).</p>
</dd>
<dt><strong>proxy</strong><span class="classifier">str, optional</span></dt><dd><p>A proxy to pass to requests Session.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
<span class="target" id="module-rabpro.elev_profile"></span><section id="elevation-profile-computation-elev-profile-py">
<h2>Elevation profile computation (elev_profile.py)<a class="headerlink" href="#elevation-profile-computation-elev-profile-py" title="Permalink to this headline"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="rabpro.elev_profile.main">
<span class="sig-prename descclassname"><span class="pre">rabpro.elev_profile.</span></span><span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gdf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_to_walk_km</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nrows</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ncols</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.elev_profile.main" title="Permalink to this definition"></a></dt>
<dd><p>Compute the elevation profile. The profile is computed such that the provided
coordinate is the centerpoint (check if this is true).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Starting point geometry. Should have a column called ‘DA’ that stores drainage
areas.
Should be in EPSG 4326 for use of the Haversine formula</p>
</dd>
<dt><strong>dist_to_walk_km</strong><span class="classifier">numeric</span></dt><dd><p>Distance in kilometers to walk up- and downstream of the provided,
mapped point to resolve the flowline</p>
</dd>
<dt><strong>verbose</strong><span class="classifier">bool</span></dt><dd><p>Defaults to False.</p>
</dd>
<dt><strong>nrows</strong><span class="classifier">int</span></dt><dd><p>Number of rows in the neighborhood of the point to search. Defaults to 50.</p>
</dd>
<dt><strong>ncols</strong><span class="classifier">int</span></dt><dd><p>Number of columns in the neighborhood of the point to search. Defaults to 50.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>The original point layer geometry.</p>
</dd>
<dt><strong>flowline</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>The elevation profile geometry.</p>
</dd>
</dl>
</dd>
<dt class="field-odd">Warns</dt>
<dd class="field-odd"><dl class="simple">
<dt>DeprecationWarning</dt><dd><p>If a list of coordinates is passed</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rabpro</span>
<span class="n">coords</span> <span class="o">=</span> <span class="p">(</span><span class="mf">56.22659</span><span class="p">,</span> <span class="o">-</span><span class="mf">130.87974</span><span class="p">)</span>
<span class="n">rpo</span> <span class="o">=</span> <span class="n">rabpro</span><span class="o">.</span><span class="n">profiler</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;basic_test&#39;</span><span class="p">)</span>
<span class="n">gdf</span><span class="p">,</span> <span class="n">flowline</span> <span class="o">=</span> <span class="n">rabpro</span><span class="o">.</span><span class="n">elev_profile</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">rpo</span><span class="o">.</span><span class="n">gdf</span><span class="p">,</span> <span class="n">dist_to_walk_km</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<span class="target" id="module-rabpro.merit_utils"></span><section id="merit-utilities-merit-utils-py">
<h2>MERIT utilities (merit_utils.py)<a class="headerlink" href="#merit-utilities-merit-utils-py" title="Permalink to this headline"></a></h2>
<p>Utility functions for dealing with MERIT datasets</p>
<dl class="py function">
<dt class="sig sig-object py" id="rabpro.merit_utils.idcs_to_geopolygons">
<span class="sig-prename descclassname"><span class="pre">rabpro.merit_utils.</span></span><span class="sig-name descname"><span class="pre">idcs_to_geopolygons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">idcs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gdobj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buf_amt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.001</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.merit_utils.idcs_to_geopolygons" title="Permalink to this definition"></a></dt>
<dd><p>Given a list of of pixel indices within a raster specified by gdobj, creates
georeferenced polygons of the blobs formed by the union of the pixels.</p>
<p>“Wrapping” is also checked - this is to handle cases where the dateline
meridian is crossed and return is therefore a set of polygons rather than a
continuous one.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>idcs</strong><span class="classifier">list of integers</span></dt><dd><p>Pixel indices within the raster specified by gdobj that should be
included in the polygon.</p>
</dd>
<dt><strong>gdobj</strong><span class="classifier">osgeo.gdal.Dataset</span></dt><dd><p>Object created by gdal.Open() on a raster or virtual raster.</p>
</dd>
<dt><strong>buf_amt</strong><span class="classifier">numeric, optional</span></dt><dd><p>Amount by which to buffer pixels before unioning-helps close tiny gaps.
By default 0.001.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>pgons</strong><span class="classifier">list of shapely.geometry.Polygon</span></dt><dd><p>List of georeferenced polygons; one per blob of indices.</p>
</dd>
<dt><strong>crossing</strong><span class="classifier">bool</span></dt><dd><p>If True, the polygons represent those that cross the dateline meridian
(i.e. 180 degrees -&gt; -180 degrees) and have been split.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.merit_utils.map_cl_pt_to_flowline">
<span class="sig-prename descclassname"><span class="pre">rabpro.merit_utils.</span></span><span class="sig-name descname"><span class="pre">map_cl_pt_to_flowline</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lonlat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">da_obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nrows</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ncols</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">basin_pgon</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fdr_obj</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fdr_map</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.merit_utils.map_cl_pt_to_flowline" title="Permalink to this definition"></a></dt>
<dd><p>Maps a point of known drainage area to a flowline of a flow accumulation
grid. Returns the row, col of the mapped-to pixel. User may provide a basin
polygon (in EPSG:4326) if already known. This polygon will be used to ensure
the mapped-to-flowline is the correct one. If the basin polygon is provided,
a flow directions object and its mapping must also be provided as well as the
drainage area.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>lonlat</strong><span class="classifier">list or tuple</span></dt><dd><p>Two-element list/tuple containing (longitude, latitude) coordinates of
the point to map to a flowline.</p>
</dd>
<dt><strong>da_obj</strong><span class="classifier">osgeo.gdal.Dataset</span></dt><dd><p>Flow accumulation object. Created by gdal.Open() on raster containing
flow accumulations.</p>
</dd>
<dt><strong>nrows</strong><span class="classifier">int</span></dt><dd><p>Number of rows in the neighborhood of the point to search.</p>
</dd>
<dt><strong>ncols</strong><span class="classifier">int</span></dt><dd><p>Number of columns in the neighborhood of the point to search.</p>
</dd>
<dt><strong>da</strong><span class="classifier">float, optional</span></dt><dd><p>Drainage area of the point/gage if known. Units should correspond to
those in da_obj, typically km^2. By default None.</p>
</dd>
<dt><strong>basin_pgon</strong><span class="classifier">shapely.geometry.polygon.Polygon, optional</span></dt><dd><p>Polygon of the watershed of the point, if known. By default None.</p>
</dd>
<dt><strong>fdr_obj</strong><span class="classifier">osgeo.gdal.Dataset, optional</span></dt><dd><p>Flow direction object. Created by gdal.Open() on raster containing flow
directions. Must be specified in order to use the basin_pgon. By default
None.</p>
</dd>
<dt><strong>fdr_map</strong><span class="classifier">list, optional</span></dt><dd><p>8-entry list corresponding to the numeric value for flow directions. The
list should take the form [NW, N, NE, W, E, SW, S, SE]. By default None.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl>
<dt><strong>(c_mapped, r_mapped)</strong><span class="classifier">tuple or None</span></dt><dd><p>x and y coordinates of the mapped points. If no mapping is possible,
None is returned. The x and y coordinates are with respect to the
fac_obj.</p>
</dd>
<dt><strong>solve_method</strong><span class="classifier">int</span></dt><dd><p>Indicates the reason why mapping succeeded/failed:
1 - (success) DA provided; a nearby flowline pixel was found within 15%</p>
<blockquote>
<div><p>of the provided DA</p>
</div></blockquote>
<dl class="simple">
<dt>2 - (success) DA provided; match was found on a nearby flowline that is</dt><dd><p>within our DA certainty bounds</p>
</dd>
</dl>
<p>3 - (success) basin polygon provided; a mappable flowline was found
4 - (success) DA not provided; mapped to the nearest flowline (&gt;1km^2)
5 - (fail) DA not provided; no nearby flowlines exist
6 - (fail) DA provided; but no nearby DAs were close enough to map to
7 - (fail) basin polygon provided; but no nearby DAs were within the allowable</p>
<blockquote>
<div><p>range</p>
</div></blockquote>
<dl class="simple">
<dt>8 - (fail) basin polygon provided; no flowlines were 25% within the provided</dt><dd><p>basin</p>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt class="field-odd">Warns</dt>
<dd class="field-odd"><dl class="simple">
<dt>UserWarning</dt><dd><p>No drainage area, flow, directions, or flow directions map provided</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.merit_utils.neighborhood_vals_from_raster">
<span class="sig-prename descclassname"><span class="pre">rabpro.merit_utils.</span></span><span class="sig-name descname"><span class="pre">neighborhood_vals_from_raster</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vrt_obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nodataval=&lt;Mock</span> <span class="pre">name='mock.nan'</span> <span class="pre">id='139671436378320'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wrap=None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.merit_utils.neighborhood_vals_from_raster" title="Permalink to this definition"></a></dt>
<dd><p>Queries a (virtual) raster object to return an array of neighbors
surrounding a given point specified by cr (column, row). A shape can be
provided to return as large of a neighborhood as desired; both dimensions
must be odd. This function is almost always unnecessary and could be
replaced with a single call to gdal’s ReadAsArray(), except that throws
errors when requesting a neighborhood that is beyond the boundaries of the
raster. Also note that requests for negative offsets do not throw errors,
which is dangerous. This function checks for those cases and handles them.</p>
<p>An option is provided to ‘wrap’ in cases where neighborhoods are requested
beyond the bounds of the raster. In these cases, the raster is effectively
“grown” by appending copies of itself to ensure no nodata are returned.
(This isn’t actually how the code works, just the simplest explanation.)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>cr</strong><span class="classifier">tuple</span></dt><dd><p>(column, row) indices within the virtual raster specifying the point
around which a neighborhood is requested.</p>
</dd>
<dt><strong>shape</strong><span class="classifier">tuple</span></dt><dd><p>Two-element tuple (nrows, ncols) specifying the shape of the
neighborhood around cr to query.</p>
</dd>
<dt><strong>vrt_obj</strong><span class="classifier">gdal.Dataset</span></dt><dd><p>Dataset object pointing to the raster from which to read; created by
gdal.Open(path_to_raster).</p>
</dd>
<dt><strong>nodataval</strong><span class="classifier">object</span></dt><dd><p>Value to assign neighbors that are beyond the bounds of the raster. By
default np.nan.</p>
</dd>
<dt><strong>wrap</strong><span class="classifier">str or None</span></dt><dd><p>String of ‘h’, ‘v’, or ‘hv’ denoting if horizontal and/or vertical
wrapping is desired. If None, no wrapping is performed. By default None.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>Ivals</strong><span class="classifier">np.array</span></dt><dd><p>Array of same dimensions as shape containing the neighborhood values.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.merit_utils.trace_flowpath">
<span class="sig-prename descclassname"><span class="pre">rabpro.merit_utils.</span></span><span class="sig-name descname"><span class="pre">trace_flowpath</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fdr_obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">da_obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cr_stpt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_to_walk_km</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fmap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[32,</span> <span class="pre">64,</span> <span class="pre">128,</span> <span class="pre">16,</span> <span class="pre">1,</span> <span class="pre">8,</span> <span class="pre">4,</span> <span class="pre">2]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.merit_utils.trace_flowpath" title="Permalink to this definition"></a></dt>
<dd><p>Returns a flowpath of pixels up- and downstream of cr_stpt a distance of
dist_to_walk_km in each direction (unless the end of the flowpath is
reached). Flowpath is returned US-&gt;DS ordered.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>fdr_obj</strong><span class="classifier">osgeo.gdal.Dataset</span></dt><dd><p>flow direction object opened with gdal.Open(). Assumes flow direction
symbology matches MERIT-Hydro:
32 64 128
16     1
8   4  2</p>
</dd>
<dt><strong>da_obj</strong><span class="classifier">osgeo.gdal.Dataset</span></dt><dd><p>drainage area object opened with gdal.Open()</p>
</dd>
<dt><strong>cr_stpt</strong><span class="classifier">numpy.ndarray</span></dt><dd><p>column, row of point to start walk</p>
</dd>
<dt><strong>cr_enpt</strong><span class="classifier">numpy.ndarray, optional</span></dt><dd><p>column, row of point to end walk. By default None</p>
</dd>
<dt><strong>n_steps</strong><span class="classifier">int, optional</span></dt><dd><p>number of steps (pixels) to walk before halting. By default None</p>
</dd>
<dt><strong>fmap</strong><span class="classifier">list, optional</span></dt><dd><p>[NW, N, NE, W, E, SW, S, SE], by default [32, 64, 128, 16, 1, 8, 4, 2]</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>tuple</dt><dd><p>(rows, cols) of flowline.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
<span class="target" id="module-rabpro.basin_stats"></span><section id="basin-statistics-basin-stats-py">
<h2>Basin statistics (basin_stats.py)<a class="headerlink" href="#basin-statistics-basin-stats-py" title="Permalink to this headline"></a></h2>
<p>Computes basin statistics using Google Earth Engine.</p>
<dl class="py class">
<dt class="sig sig-object py" id="rabpro.basin_stats.Dataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">rabpro.basin_stats.</span></span><span class="sig-name descname"><span class="pre">Dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">band</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'None'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resolution</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stats</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_stats</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mosaic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prepend_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.basin_stats.Dataset" title="Permalink to this definition"></a></dt>
<dd><p>Represents one band of a GEE dataset with parameters specifying how to
compute statistics.</p>
<dl class="field-list simple">
<dt class="field-odd">Attributes</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>data_id</strong><span class="classifier">str</span></dt><dd><p>Google Earth Engine dataset asset id</p>
</dd>
<dt><strong>band</strong><span class="classifier">str, optional</span></dt><dd><p>Google Earth Engine dataset band name</p>
</dd>
<dt><strong>resolution</strong><span class="classifier">int, optional</span></dt><dd><p>Desired resolution in meters of the calculation over the dataset.
Defaults to native resolution of the dataset.</p>
</dd>
<dt><strong>start</strong><span class="classifier">str, optional</span></dt><dd><p>Desired start date of data in ISO format: YYYY-MM-DD. Defaults to None which
GEE interprets as the dataset start.</p>
</dd>
<dt><strong>end</strong><span class="classifier">str, optional</span></dt><dd><p>Desired end date of data in ISO format: YYYY-MM-DD. Defaults to None which GEE
interprets as the dataset end.</p>
</dd>
<dt><strong>stats</strong><span class="classifier">list, optional</span></dt><dd><p>List of desired stats to compute: min, max, range, mean, count, std,
sum, and percentiles in the following format: pct1, pct90, pct100, etc.
Computes [“count”, “mean”] by default.</p>
</dd>
<dt><strong>time_stats</strong><span class="classifier">list, optional</span></dt><dd><p>List of desired stats to compute through time.</p>
</dd>
<dt><strong>mask</strong><span class="classifier">bool, optional</span></dt><dd><p>Whether or not to mask out water in the dataset using the Global Surface
Water occurrence band. By default False.</p>
</dd>
<dt><strong>mosaic</strong><span class="classifier">bool, optional</span></dt><dd><p>If True, the imageCollection in data_id will be mosaiced first. Useful
when the imageCollection is a set of tiled images. Do not use for
time-varying imageCollections.</p>
</dd>
<dt><strong>prepend_label</strong><span class="classifier">str, optional</span></dt><dd><p>Text to prepend to the exported statistics file.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.basin_stats.compute">
<span class="sig-prename descclassname"><span class="pre">rabpro.basin_stats.</span></span><span class="sig-name descname"><span class="pre">compute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gee_feature_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">basins_gdf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reducer_funcs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">folder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.basin_stats.compute" title="Permalink to this definition"></a></dt>
<dd><p>Compute subbasin statistics for each dataset and band specified.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>dataset_list</strong><span class="classifier">list of Datasets</span></dt><dd><p>List of rabpro Dataset objects to compute statistics over.</p>
</dd>
<dt><strong>basins_gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Table of subbasin geometries.</p>
</dd>
<dt><strong>gee_feature_path</strong><span class="classifier">string</span></dt><dd><p>Path to a GEE feature collection</p>
</dd>
<dt><strong>reducer_funcs</strong><span class="classifier">list of functions, optional</span></dt><dd><p>List of functions to apply to each feature over each dataset. Each
function should take in an ee.Feature() object. For example, this is how
the function and header are applied on a feature:
feature.set(f.__name__, function(feature))</p>
</dd>
<dt><strong>verbose</strong><span class="classifier">bool, optional</span></dt><dd><p>By default False.</p>
</dd>
<dt><strong>folder</strong><span class="classifier">str, optional</span></dt><dd><p>Google Drive folder to store results in, by default top-level root.</p>
</dd>
<dt><strong>test</strong><span class="classifier">bool, optional</span></dt><dd><p>Return results to the active python session in addition to GDrive</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rabpro</span>
<span class="kn">from</span> <span class="nn">rabpro.subbasin_stats</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">box</span>

<span class="n">total_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">85.91331249</span><span class="p">,</span> <span class="mf">39.42609864</span><span class="p">,</span> <span class="o">-</span><span class="mf">85.88453019</span><span class="p">,</span> <span class="mf">39.46429816</span><span class="p">])</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s2">&quot;idx&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">box</span><span class="p">(</span><span class="o">*</span><span class="n">total_bounds</span><span class="p">)]},</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

<span class="c1"># defaults</span>
<span class="n">data</span><span class="p">,</span> <span class="n">task</span> <span class="o">=</span> <span class="n">rabpro</span><span class="o">.</span><span class="n">subbasin_stats</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">Dataset</span><span class="p">(</span>
            <span class="s2">&quot;JRC/GSW1_3/MonthlyRecurrence&quot;</span><span class="p">,</span>
            <span class="s2">&quot;monthly_recurrence&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">],</span>
    <span class="n">basins_gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">,</span>
    <span class="n">test</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># with time_stats specified</span>
<span class="n">data</span><span class="p">,</span> <span class="n">task</span> <span class="o">=</span> <span class="n">rabpro</span><span class="o">.</span><span class="n">subbasin_stats</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">Dataset</span><span class="p">(</span>
            <span class="s2">&quot;JRC/GSW1_3/MonthlyRecurrence&quot;</span><span class="p">,</span>
            <span class="s2">&quot;monthly_recurrence&quot;</span><span class="p">,</span>
            <span class="n">time_stats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="p">],</span>
    <span class="n">basins_gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">,</span>
    <span class="n">test</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.basin_stats.fetch_gee">
<span class="sig-prename descclassname"><span class="pre">rabpro.basin_stats.</span></span><span class="sig-name descname"><span class="pre">fetch_gee</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">url_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prepend_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col_drop_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col_protect_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['id_basin',</span> <span class="pre">'id_outlet',</span> <span class="pre">'idx',</span> <span class="pre">'id',</span> <span class="pre">'vote_id']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col_drop_defaults</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['DA',</span> <span class="pre">'count',</span> <span class="pre">'.geo',</span> <span class="pre">'da_km2']</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.basin_stats.fetch_gee" title="Permalink to this definition"></a></dt>
<dd><p>Download and format data from GEE urls</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>url_list</strong><span class="classifier">list</span></dt><dd><p>list of urls returned from compute</p>
</dd>
<dt><strong>prepend_list</strong><span class="classifier">list</span></dt><dd><p>tags to pre-append to corresponding columns, of length url_list</p>
</dd>
<dt><strong>col_drop_list</strong><span class="classifier">list, optional</span></dt><dd><p>custom columns to drop, by default []</p>
</dd>
<dt><strong>col_protect_list</strong><span class="classifier">list, optional</span></dt><dd><p>columns to avoid tagging, by default [“id_basin”, “id_outlet”, “idx”, “id”,
“vote_id”]</p>
</dd>
<dt><strong>col_drop_defaults</strong><span class="classifier">list, optional</span></dt><dd><p>built-in columns to drop, by default [“DA”, “count”, “.geo”, “system:index”,
“da_km2”]</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>DataFrame</dt><dd></dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">box</span>

<span class="kn">import</span> <span class="nn">rabpro</span>
<span class="kn">from</span> <span class="nn">rabpro.basin_stats</span> <span class="kn">import</span> <span class="n">Dataset</span>

<span class="n">total_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">85.91331249</span><span class="p">,</span> <span class="mf">39.42609864</span><span class="p">,</span> <span class="o">-</span><span class="mf">85.88453019</span><span class="p">,</span> <span class="mf">39.46429816</span><span class="p">])</span>
<span class="n">basin</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s2">&quot;idx&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">box</span><span class="p">(</span><span class="o">*</span><span class="n">total_bounds</span><span class="p">)]},</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

<span class="n">dataset_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Dataset</span><span class="p">(</span><span class="s2">&quot;ECMWF/ERA5_LAND/MONTHLY&quot;</span><span class="p">,</span> <span class="s2">&quot;temperature_2m&quot;</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span> <span class="n">time_stats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">]),</span>
    <span class="n">Dataset</span><span class="p">(</span><span class="s2">&quot;NASA/GPM_L3/IMERG_MONTHLY_V06&quot;</span><span class="p">,</span> <span class="s2">&quot;precipitation&quot;</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span> <span class="n">time_stats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">]),</span>
<span class="p">]</span>

<span class="n">urls</span><span class="p">,</span> <span class="n">tasks</span> <span class="o">=</span> <span class="n">rabpro</span><span class="o">.</span><span class="n">basin_stats</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span>
    <span class="n">dataset_list</span><span class="p">,</span> <span class="n">basins_gdf</span><span class="o">=</span><span class="n">basin</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s2">&quot;rabpro&quot;</span>
<span class="p">)</span>

<span class="n">tag_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;precip&quot;</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">rabpro</span><span class="o">.</span><span class="n">basin_stats</span><span class="o">.</span><span class="n">fetch_gee</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">,</span> <span class="n">col_drop_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;system:index&quot;</span><span class="p">])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.basin_stats.format_gee">
<span class="sig-prename descclassname"><span class="pre">rabpro.basin_stats.</span></span><span class="sig-name descname"><span class="pre">format_gee</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prepend_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col_drop_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col_protect_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['id_basin',</span> <span class="pre">'id_outlet',</span> <span class="pre">'idx',</span> <span class="pre">'id',</span> <span class="pre">'vote_id']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col_drop_defaults</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['DA',</span> <span class="pre">'count',</span> <span class="pre">'.geo',</span> <span class="pre">'da_km2']</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.basin_stats.format_gee" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>df_list</strong><span class="classifier">list</span></dt><dd><p>list of DataFrames</p>
</dd>
<dt><strong>prepend_list</strong><span class="classifier">list</span></dt><dd><p>tags to pre-append to corresponding columns, of length url_list</p>
</dd>
<dt><strong>col_drop_list</strong><span class="classifier">list, optional</span></dt><dd><p>custom columns to drop, by default []</p>
</dd>
<dt><strong>col_protect_list</strong><span class="classifier">list, optional</span></dt><dd><p>columns to avoid tagging, by default [“id_basin”, “id_outlet”, “idx”, “id”,
“vote_id”]</p>
</dd>
<dt><strong>col_drop_defaults</strong><span class="classifier">list, optional</span></dt><dd><p>built-in columns to drop, by default [“DA”, “count”, “.geo”, “system:index”,
“da_km2”]</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>DataFrame</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.basin_stats.image">
<span class="sig-prename descclassname"><span class="pre">rabpro.basin_stats.</span></span><span class="sig-name descname"><span class="pre">image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gee_feature_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">basins_gdf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">categorical</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[False]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.basin_stats.image" title="Permalink to this definition"></a></dt>
<dd><p>Download a GEE raster as a GeoTiff clipped to a basins GeoDataFrame</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>dataset_list</strong><span class="classifier">list of Datasets</span></dt><dd><p>List of Dataset objects to compute statistics over.</p>
</dd>
<dt><strong>gee_feature_path</strong><span class="classifier">str, optional</span></dt><dd><p>Path to a GEE feature collection, by default None</p>
</dd>
<dt><strong>basins_gdf</strong><span class="classifier">GeoDataFrame, optional</span></dt><dd><p>Table of subbasin geometries, by default None</p>
</dd>
<dt><strong>categorical</strong><span class="classifier">list, optional</span></dt><dd><p>By default [False]</p>
</dd>
<dt><strong>verbose</strong><span class="classifier">bool, optional</span></dt><dd><p>By default False</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>list</dt><dd><p>of GeoTiff download urls</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rabpro</span>
<span class="kn">from</span> <span class="nn">rabpro.basin_stats</span> <span class="kn">import</span> <span class="n">Dataset</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">box</span>

<span class="n">total_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">85.91331249</span><span class="p">,</span> <span class="mf">39.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">85.5</span><span class="p">,</span> <span class="mf">39.46429816</span><span class="p">])</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s2">&quot;idx&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">box</span><span class="p">(</span><span class="o">*</span><span class="n">total_bounds</span><span class="p">)]},</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

<span class="n">dataset_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Dataset</span><span class="p">(</span><span class="s2">&quot;ECMWF/ERA5_LAND/MONTHLY&quot;</span><span class="p">,</span> <span class="s2">&quot;temperature_2m&quot;</span><span class="p">,</span> <span class="n">time_stats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">])</span>
<span class="p">]</span>
<span class="n">urls</span><span class="p">,</span> <span class="n">tasks</span> <span class="o">=</span> <span class="n">rabpro</span><span class="o">.</span><span class="n">basin_stats</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">dataset_list</span><span class="p">,</span> <span class="n">basins_gdf</span><span class="o">=</span><span class="n">gdf</span><span class="p">)</span>
<span class="n">basin_stats</span><span class="o">.</span><span class="n">_fetch_raster</span><span class="p">(</span><span class="n">urls</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</dd></dl>

</section>
<span class="target" id="module-rabpro.basins"></span><section id="basin-delineation-basins-py">
<h2>Basin delineation (basins.py)<a class="headerlink" href="#basin-delineation-basins-py" title="Permalink to this headline"></a></h2>
<p>Functions to calculate basin geometries.</p>
<dl class="py function">
<dt class="sig sig-object py" id="rabpro.basins.load_continent_basins">
<span class="sig-prename descclassname"><span class="pre">rabpro.basins.</span></span><span class="sig-name descname"><span class="pre">load_continent_basins</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gdf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level_one</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level_twelve</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.basins.load_continent_basins" title="Permalink to this definition"></a></dt>
<dd><p>Load a HydroBasins continent polygon</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Geometry data. Should be in EPSG:4326.</p>
</dd>
<dt><strong>level_one</strong><span class="classifier">str</span></dt><dd><p>Path to level 1 HydroBasins data</p>
</dd>
<dt><strong>level_twelve</strong><span class="classifier">str</span></dt><dd><p>Path to level 12 HydroBasins data</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>GeoDataFrame</dt><dd><p>HydroBasins</p>
</dd>
</dl>
</dd>
<dt class="field-odd">Warns</dt>
<dd class="field-odd"><dl class="simple">
<dt>UserWarning</dt><dd><p>If coordinate does not lie in the HydroBasins polygons</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.basins.main_hb">
<span class="sig-prename descclassname"><span class="pre">rabpro.basins.</span></span><span class="sig-name descname"><span class="pre">main_hb</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gdf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.basins.main_hb" title="Permalink to this definition"></a></dt>
<dd><p>Calculates basins using HydroBASINS</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Contains geometry and DA (drainage area) columns.</p>
</dd>
<dt><strong>verbose</strong><span class="classifier">bool, optional</span></dt><dd><p>By default False</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>subbasins_gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Contains subbasin geometries</p>
</dd>
<dt><strong>sb_inc_gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Contains the polygons of the incremental catchments. The upstream-most
basin will be the largest polygon in most cases, but that depends on the
input centerline.</p>
</dd>
<dt><strong>cl_das</strong><span class="classifier">numpy.ndarray</span></dt><dd><p>Drainage areas</p>
</dd>
</dl>
</dd>
<dt class="field-odd">Warns</dt>
<dd class="field-odd"><dl class="simple">
<dt>RuntimeWarning</dt><dd><p>If gdf has no CRS defined</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rabpro</span>
<span class="n">coords</span> <span class="o">=</span> <span class="p">(</span><span class="mf">56.22659</span><span class="p">,</span> <span class="o">-</span><span class="mf">130.87974</span><span class="p">)</span>
<span class="n">rpo</span> <span class="o">=</span> <span class="n">rabpro</span><span class="o">.</span><span class="n">profiler</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;basic_test&#39;</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">rabpro</span><span class="o">.</span><span class="n">basins</span><span class="o">.</span><span class="n">main_hb</span><span class="p">(</span><span class="n">rpo</span><span class="o">.</span><span class="n">gdf</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.basins.main_merit">
<span class="sig-prename descclassname"><span class="pre">rabpro.basins.</span></span><span class="sig-name descname"><span class="pre">main_merit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gdf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">da</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nrows</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">51</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ncols</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">51</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">map_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.basins.main_merit" title="Permalink to this definition"></a></dt>
<dd><p>Calculates basins using MERIT</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Centerline coordinates</p>
</dd>
<dt><strong>da</strong><span class="classifier">numeric</span></dt><dd><p>Drainage area in km^2</p>
</dd>
<dt><strong>nrows</strong><span class="classifier">int</span></dt><dd><p>by default 51</p>
</dd>
<dt><strong>ncols</strong><span class="classifier">int</span></dt><dd><p>by default 51</p>
</dd>
<dt><strong>map_only</strong><span class="classifier">bool</span></dt><dd><p>If True, will map the coordinate to a MERIT flowline but not delineate
the basin. The default is False.</p>
</dd>
<dt><strong>verbose</strong><span class="classifier">bool</span></dt><dd><p>by default False</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>basins</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>The delineated watershed</p>
</dd>
<dt><strong>mapped</strong><span class="classifier">dict</span></dt><dd><p>Information about the mapping quality.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
<span class="target" id="module-rabpro.utils"></span><section id="utility-functions-utils-py">
<h2>Utility functions (utils.py)<a class="headerlink" href="#utility-functions-utils-py" title="Permalink to this headline"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.area_4326">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">area_4326</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pgons_4326</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.area_4326" title="Permalink to this definition"></a></dt>
<dd><p>Given a list of shapely polygons in EPSG:4326, compute the area in km^2.
Only returns the area of the perimeter; does not yet account for holes
in the polygon. Mutlipolygons are supported.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.build_gee_vector_asset">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">build_gee_vector_asset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">basins</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'basins.zip'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.build_gee_vector_asset" title="Permalink to this definition"></a></dt>
<dd><p>Create zipped shapefile for uploading as a Google Earth Engine vector asset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>basins</strong><span class="classifier">GeoDataFrame</span></dt><dd></dd>
<dt><strong>out_path</strong><span class="classifier">str, optional</span></dt><dd><p>by default “basins.zip”</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>str</dt><dd><p>path to zip file</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rabpro</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="n">basins</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;tests/results/merit_test/subbasins.json&quot;</span><span class="p">)</span>
<span class="n">utils</span><span class="o">.</span><span class="n">build_gee_vector_asset</span><span class="p">(</span><span class="n">basins</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.build_virtual_rasters">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">build_virtual_rasters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datapaths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_if_exists</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.build_virtual_rasters" title="Permalink to this definition"></a></dt>
<dd><p>Builds virtual rasters on the four MERIT-Hydro tilesets.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>datapaths: dict</strong></dt><dd><p>Contains the paths to the data. Generate with get_datapaths().</p>
</dd>
<dt><strong>skip_if_exists: bool, optional</strong></dt><dd><p>If True, will not rebuild the virtual raster if one already exists.
The default is False.</p>
</dd>
<dt><strong>verbose: bool, optional</strong></dt><dd><p>If True, will provide updates as virtual rasters are built.</p>
</dd>
<dt><strong>**kwargs</strong></dt><dd><p>Arguments passed to the build_vrt function.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Warns</dt>
<dd class="field-even"><dl class="simple">
<dt>RuntimeWarning</dt><dd><p>Missing data</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rabpro</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="n">d_paths</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_datapaths</span><span class="p">()</span>
<span class="n">utils</span><span class="o">.</span><span class="n">build_virtual_rasters</span><span class="p">(</span><span class="n">d_paths</span><span class="p">,</span> <span class="n">extents</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">180.00041666666667</span><span class="p">,</span> <span class="mf">179.99958333333913</span><span class="p">,</span> <span class="mf">84.99958333333333</span><span class="p">,</span> <span class="o">-</span><span class="mf">60.000416666669</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.build_vrt">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">build_vrt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tilespath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clipper</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extents</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nodataval</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">res</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sampling</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nearest'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ftype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'tif'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quiet</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.build_vrt" title="Permalink to this definition"></a></dt>
<dd><p>Creates a text file for input to gdalbuildvrt, then builds vrt file with
same name. If output path is not specified, vrt is given the name of the
final folder in the path.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>tilespath</strong><span class="classifier">str</span></dt><dd><p>the path to the file (or folder of files) to be clipped– if tilespath
contains an extension (e.g. .tif, .vrt), then that file is used.
Otherwise, a virtual raster will be built of all the files in the
provided folder. if filespath contains an extension (e.g. .tif, .vrt),
filenames of tiffs to be written to vrt. This list can be created by
tifflist and should be in the same folder</p>
</dd>
<dt><strong>clipper</strong><span class="classifier">str, optional</span></dt><dd><p>path to a georeferenced image, vrt, or shapefile that will be used to
clip. By default None</p>
</dd>
<dt><strong>extents</strong><span class="classifier">list, optional</span></dt><dd><p>the extents by which to crop the vrt. Extents should be a 4 element
list: [left, right, top, bottom] in the same projection coordinates as
the file(s) to be clipped. By default None</p>
</dd>
<dt><strong>outputfile</strong><span class="classifier">str, optional</span></dt><dd><p>path (including filename w/ext) to output the vrt. If none is provided,
the vrt will be saved in the ‘filespath’ path. By default None</p>
</dd>
<dt><strong>nodataval</strong><span class="classifier">int, optional</span></dt><dd><p>value to be masked as nodata, by default None</p>
</dd>
<dt><strong>res</strong><span class="classifier">flt, optional</span></dt><dd><p>resolution of the output vrt (applied to both x and y directions), by
default None</p>
</dd>
<dt><strong>sampling</strong><span class="classifier">str, optional</span></dt><dd><p>resampling scheme (nearest, bilinear, cubic, cubicspline, lanczos,
average, mode), by default “nearest”</p>
</dd>
<dt><strong>ftype</strong><span class="classifier">str, optional</span></dt><dd><p>“tif” if building from a list of tiffs, or “vrt” if building from a vrt,
by default “tif”</p>
</dd>
<dt><strong>separate</strong><span class="classifier">bool, optional</span></dt><dd><p>See separate argument to gdalbuildvrt, by default False</p>
</dd>
<dt><strong>quiet</strong><span class="classifier">bool, optional</span></dt><dd><p>Set True to print progress, by default False</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>str</dt><dd><p>path of the built virtual raster</p>
</dd>
</dl>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><dl class="simple">
<dt>TypeError</dt><dd><p>Unsupported file type passed in ‘ftype’</p>
</dd>
<dt>RuntimeError</dt><dd><p>No files found to build raster or raster build fails</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.coords_to_merit_tile">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">coords_to_merit_tile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.coords_to_merit_tile" title="Permalink to this definition"></a></dt>
<dd><p>Identify MERIT-Hydro “tiles” of interest. See
<a class="reference external" href="http://hydro.iis.u-tokyo.ac.jp/~yamadai/MERIT_Hydro/">http://hydro.iis.u-tokyo.ac.jp/~yamadai/MERIT_Hydro/</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>lon</strong><span class="classifier">float</span></dt><dd></dd>
<dt><strong>lat</strong><span class="classifier">float</span></dt><dd></dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rabpro</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="n">utils</span><span class="o">.</span><span class="n">coords_to_merit_tile</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="o">-</span><span class="mi">17</span><span class="p">)</span>
<span class="c1"># &gt; &quot;s30e150&quot;</span>
<span class="n">utils</span><span class="o">.</span><span class="n">coords_to_merit_tile</span><span class="p">(</span><span class="o">-</span><span class="mi">118</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
<span class="c1"># &gt; &quot;n30w120&quot;</span>
<span class="n">utils</span><span class="o">.</span><span class="n">coords_to_merit_tile</span><span class="p">(</span><span class="o">-</span><span class="mf">97.355</span><span class="p">,</span> <span class="mf">45.8358</span><span class="p">)</span>
<span class="c1"># &gt; &quot;n30w120&quot;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.crop_binary_coords">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">crop_binary_coords</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">coords</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.crop_binary_coords" title="Permalink to this definition"></a></dt>
<dd><p>Crops an array of (row, col) coordinates (e.g. blob indices) to the smallest
possible array.
Taken from RivGraph.im_utils</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>coords: np.array</strong></dt><dd><p>N x 2 array. First column are rows, second are columns of pixel coordinates.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>I: np.array</dt><dd><p>Image of the cropped coordinates, plus padding if desired.</p>
</dd>
<dt>clipped: list</dt><dd><p>Number of pixels in [left, top, right, bottom] direction that were
clipped.  Clipped returns the indices within the original coords image
that define where I should be positioned within the original image.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.dist_from_da">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">dist_from_da</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">da</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nwidths</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.dist_from_da" title="Permalink to this definition"></a></dt>
<dd><p>Returns the along-stream distance of a flowline to resolve for a given
DA. An empirical formula provided by
<a class="reference external" href="https://agupubs.onlinelibrary.wiley.com/doi/full/10.1002/2013WR013916">https://agupubs.onlinelibrary.wiley.com/doi/full/10.1002/2013WR013916</a>
(equation 15) is used to estimate width.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>da</strong><span class="classifier">float or numeric</span></dt><dd><p>drainage area in km^2</p>
</dd>
<dt><strong>nwidths</strong><span class="classifier">numeric</span></dt><dd><p>number of channel widths to set distance</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>dist: float</dt><dd><p>Distance in kilometers that represents nwidths*W_bankfull where
W_bankfull computed according to Wilkerson et al., 2014.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.get_datapaths">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">get_datapaths</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">root_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_gee_metadata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.get_datapaths" title="Permalink to this definition"></a></dt>
<dd><p>Returns a dictionary of paths to all data that rabpro uses. Also builds
virtual rasters for MERIT data and downloads latest version of GEE catalog.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>root_path: string, optional</strong></dt><dd><p>Path to rabpro Data folder that contains the HydroBASINS, MERIT-Hydro,
and/or gee catalog jsons. Will read from an environment variable
“RABPRO_DATA”. If this variable is not set, uses appdirs to create a
local data directory. This path is the parent directory for the MERIT
and HydroBasins data directories.</p>
</dd>
<dt><strong>config_path: string, optional</strong></dt><dd><p>Path to rabpro config folder. Will read from an environment variable
“RABPRO_CONFIG”. If not set, uses appdirs to create local directory.</p>
</dd>
<dt><strong>force: boolean, optional</strong></dt><dd><p>Set True to override datapath caching. Otherwise only fetched once per py
session.</p>
</dd>
<dt><strong>update_gee_metadata: boolean, optional</strong></dt><dd><p>If True, will attempt to download the latest GEE dataset metadata.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>dict</dt><dd><p>contains paths to all data that rabpro uses</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rabpro</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="n">utils</span><span class="o">.</span><span class="n">get_datapaths</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.get_exportpaths">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">get_exportpaths</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">basepath</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.get_exportpaths" title="Permalink to this definition"></a></dt>
<dd><p>Returns a dictionary of paths for exporting rabpro results. Also creates
“results” folders when necessary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>name</strong><span class="classifier">str</span></dt><dd><p>Name of directory to create within “results” directory.</p>
</dd>
<dt><strong>basepath</strong><span class="classifier">str, optional</span></dt><dd><p>path to put “results” directory. By default None. If None, creates in
current working directory.</p>
</dd>
<dt><strong>overwrite</strong><span class="classifier">bool, optional</span></dt><dd><p>overwrite “name” directory, by default False</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>dict</dt><dd><p>contains paths to all output that rabpro generates</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.haversine">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">haversine</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lats</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lons</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.haversine" title="Permalink to this definition"></a></dt>
<dd><p>Computes distances between latitude and longitude pairs of points.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>lats</strong><span class="classifier">numpy array (or interpretable by numpy)</span></dt><dd><p>latitude values</p>
</dd>
<dt><strong>lons</strong><span class="classifier">numpy array (or interpretable by numpy)</span></dt><dd><p>longitude values</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>numpy.ndarray</dt><dd><p>Distance in meters between each point defined by lats, lons.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.lonlat_plus_distance">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">lonlat_plus_distance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bearing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.lonlat_plus_distance" title="Permalink to this definition"></a></dt>
<dd><p>Returns the lon, lat coordinates of a point that is dist away (dist in km)
and with a given bearing (in degrees, 0 is North). Uses a Haversine
approximation.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.raster_extents">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">raster_extents</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raster_path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.raster_extents" title="Permalink to this definition"></a></dt>
<dd><p>Output raster extents as [xmin, xmax, ymin, ymax]</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>raster_path</strong><span class="classifier">str</span></dt><dd><p>Path to file</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>list</dt><dd><p>[xmin, xmax, ymin, ymax]</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rabpro</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="n">utils</span><span class="o">.</span><span class="n">raster_extents</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_datapaths</span><span class="p">(</span><span class="n">rebuild_vrts</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;DEM_fdr&quot;</span><span class="p">])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.union_gdf_polygons">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">union_gdf_polygons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gdf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idcs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.union_gdf_polygons" title="Permalink to this definition"></a></dt>
<dd><p>Given an input geodataframe and a list of indices, return a shapely geometry
that unions the geometries found at idcs into a single shapely geometry
object.</p>
<p>This function also buffers each polygon slightly, then un-buffers the
unioned polygon by the same amount. This is to avoid errors associated with
floating-point round-off; see here:
<a class="reference external" href="https://gis.stackexchange.com/questions/277334/shapely-polygon-union-results-in-strange-artifacts-of-tiny-non-overlapping-area">https://gis.stackexchange.com/questions/277334/shapely-polygon-union-results-in-strange-artifacts-of-tiny-non-overlapping-area</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Geometries to combine</p>
</dd>
<dt><strong>idcs</strong><span class="classifier">list</span></dt><dd><p>Indicates which geometris in ‘gdf’ to combine</p>
</dd>
<dt><strong>buffer</strong><span class="classifier">bool, optional</span></dt><dd><p>buffer polygons, by default True</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>shapely.geometry object</dt><dd><p>Union of passed geometries</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.upload_gee_tif_asset">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">upload_gee_tif_asset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tif_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gee_user</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gcp_bucket</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gcp_folder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gee_folder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'4326'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">citation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gcp_upload</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gee_upload</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dry_run</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gee_force</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.upload_gee_tif_asset" title="Permalink to this definition"></a></dt>
<dd><p>Upload a GeoTIFF file as a GEE raster asset</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>tif_path</strong><span class="classifier">str</span></dt><dd><p>Path to GeoTIFF file</p>
</dd>
<dt><strong>gee_user</strong><span class="classifier">str</span></dt><dd><p>Google Earth Engine user name</p>
</dd>
<dt><strong>gcp_bucket</strong><span class="classifier">str</span></dt><dd><p>Google Cloud Platform bucket url</p>
</dd>
<dt><strong>title</strong><span class="classifier">str</span></dt><dd><p>GEE asset title</p>
</dd>
<dt><strong>gcp_folder</strong><span class="classifier">str, optional</span></dt><dd><p>Google Cloud Platform bucket folder, by default “”</p>
</dd>
<dt><strong>gee_folder</strong><span class="classifier">str, optional</span></dt><dd><p>Google Earth Engine asset folder, by default “”</p>
</dd>
<dt><strong>time_start</strong><span class="classifier">str, optional</span></dt><dd><p>YYYY-MM-DD, by default “”</p>
</dd>
<dt><strong>epsg</strong><span class="classifier">str, optional</span></dt><dd><p>EPSG CRS code, by default “4326”</p>
</dd>
<dt><strong>description</strong><span class="classifier">str, optional</span></dt><dd><p>GEE asset description text, by default “”</p>
</dd>
<dt><strong>citation</strong><span class="classifier">str, optional</span></dt><dd><p>GEE asset citation text, appended to description, by default “”</p>
</dd>
<dt><strong>gcp_upload</strong><span class="classifier">bool, optional</span></dt><dd><p>Set False to skip GCP uploading, by default True</p>
</dd>
<dt><strong>gee_upload</strong><span class="classifier">bool, optional</span></dt><dd><p>Set False to skip GEE uploading, by default True</p>
</dd>
<dt><strong>dry_run</strong><span class="classifier">bool, optional</span></dt><dd><p>Set True to skip GCP and GEE uploading, by default False</p>
</dd>
<dt><strong>gee_force</strong><span class="classifier">bool, optional</span></dt><dd><p>Set True to overwrite any existing GEE assets, by default False</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>NoneType</dt><dd><p>None</p>
</dd>
</dl>
</dd>
<dt class="field-odd">Warns</dt>
<dd class="field-odd"><dl class="simple">
<dt>RuntimeWarning</dt><dd></dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rabpro</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="n">utils</span><span class="o">.</span><span class="n">upload_gee_tif_asset</span><span class="p">(</span><span class="s2">&quot;my.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;my_gee_user&quot;</span><span class="p">,</span> <span class="s2">&quot;my_gcp_bucket&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.upload_gee_vector_asset">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">upload_gee_vector_asset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">zip_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gee_user</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gcp_bucket</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gcp_folder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gcp_upload</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gee_upload</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.upload_gee_vector_asset" title="Permalink to this definition"></a></dt>
<dd><p>Upload a zipped shapefile as a GEE vector asset</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>zip_path</strong><span class="classifier">str</span></dt><dd><p>Path to zipped shapefile.</p>
</dd>
<dt><strong>gee_user</strong><span class="classifier">str</span></dt><dd><p>Google Earth Engine user name.</p>
</dd>
<dt><strong>gcp_bucket</strong><span class="classifier">str</span></dt><dd><p>Google Cloud Platform bucket url (e.g. gs://my_bucket_name).</p>
</dd>
<dt><strong>gcp_folder</strong><span class="classifier">str, optional</span></dt><dd><p>Google Cloud Platform bucket folder, by default “”</p>
</dd>
<dt><strong>gcp_upload</strong><span class="classifier">bool, optional</span></dt><dd><p>Set False to skip GCP uploading, by default True</p>
</dd>
<dt><strong>gee_upload</strong><span class="classifier">bool, optional</span></dt><dd><p>Set False to skip GEE uploading, by default True</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>str</dt><dd><p>GEE asset path</p>
</dd>
</dl>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><dl class="simple">
<dt>RuntimeError</dt><dd><p>Throws error if gsutil is not installed or authenticated.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rabpro</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="n">utils</span><span class="o">.</span><span class="n">upload_gee_vector_asset</span><span class="p">(</span><span class="s2">&quot;test.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;my_gee_user&quot;</span><span class="p">,</span> <span class="s2">&quot;my_gcp_bucket&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.validify_polygons">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">validify_polygons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">polys</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.validify_polygons" title="Permalink to this definition"></a></dt>
<dd><p>Hacky ways to validify a (multi)polygon. If can’t be validified, returns the
original.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>geom</strong><span class="classifier">list</span></dt><dd><p>List of shapely.geometry.Polygon</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>geomsv</strong><span class="classifier">list</span></dt><dd><p>List of shapely.geometry.Polygon that have been attempted to validify.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.xy_to_coords">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">xy_to_coords</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ys</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.xy_to_coords" title="Permalink to this definition"></a></dt>
<dd><p>Transforms a set of x and y coordinates to their corresponding coordinates
within a geotiff image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>xs</strong><span class="classifier">numpy.ndarray</span></dt><dd><p>x coordinates to transform</p>
</dd>
<dt><strong>ys</strong><span class="classifier">numpy.ndarray</span></dt><dd><p>y coordinates to transform</p>
</dd>
<dt><strong>gt</strong><span class="classifier">tuple</span></dt><dd><p>6-element tuple gdal GeoTransform. (uL_x, x_res, rotation, ul_y, rotation,
y_res).
Automatically created by gdal’s GetGeoTransform() method.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>cx, cy</strong><span class="classifier">tuple of ints</span></dt><dd><p>Column and row indices of the provided coordinates.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="API Reference" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, J. Schwenk, J. Stachelek, T. Zussman, &amp; J. Rowland.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>