<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Basic example &mdash; rabpro  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-dropdown.css?v=995e94df" />
      <link rel="stylesheet" type="text/css" href="../../_static/panels-bootstrap.min.css?v=21c0b90a" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=f3cb8367" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Multiple basins" href="multiple_basins.html" />
    <link rel="prev" title="Downloading data" href="downloading_data.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            rabpro
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Setup:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configure/index.html">Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="downloading_data.html">Downloading data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Basic example</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiple_basins.html">Multiple basins</a></li>
<li class="toctree-l1"><a class="reference internal" href="basin_stats.html">Basin stats examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellanea:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../issues/index.html">Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../references/index.html">Citing rabpro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apiref/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">rabpro</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Basic example</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Basic-example">
<h1>Basic example<a class="headerlink" href="#Basic-example" title="Link to this heading"></a></h1>
<p>This example demonstrates some of the core functionality and export features provided by rabpro.</p>
<p>Note: you will need to download HydroBasins to run this demo. See <a class="reference external" href="https://github.com/VeinsOfTheEarth/rabpro/blob/main/docs/source/examples/notebooks/downloading_data.ipynb">this notebook</a> for download instructions.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from matplotlib import pyplot as plt

import rabpro
</pre></div>
</div>
</div>
<p>First, we need to specify a point for which we’d like a watershed delineated.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>coords = (44.9331, -69.4996)
</pre></div>
</div>
</div>
<p>Now we can initialize the profiler. The rabpro profiler is the main entry point into the package - it provides wrapper funcitons for most of the rabpro’s core functionality.</p>
<p>Note that we can optionally specify a drainage area (<code class="docutils literal notranslate"><span class="pre">da</span></code>) or set <code class="docutils literal notranslate"><span class="pre">force_merit</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>, to ensure that we use MERIT data rather than HydroBasins to perform basin delineation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>rpo = rabpro.profiler(coords, name=&#39;basic_test&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
https://raw.githubusercontent.com/VeinsOfTheEarth/rabpro/main/Data/gee_datasets.json download error. Place manually into D:\merit_data\Data\gee_datasets.json
</pre></div></div>
</div>
<p>rabpro can now compute the watershed for this point. Since we are not providing a pre-known drainage area to the profiler or specifying <code class="docutils literal notranslate"><span class="pre">force_merit=True</span></code>, rabpro will use HydroBasins to delineate the watershed. Delineation may take a minute or two as rabpro has to identify the correct level-12 HydroBasins shapefile and load it into memory (these files are &gt;100MB).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
rpo.delineate_basin()
</pre></div>
</div>
</div>
<p>The basin geometry is stored in a GeoPandas GeoDataFrame, and can be accessed through the <code class="docutils literal notranslate"><span class="pre">rpo</span></code> object.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>rpo.watershed.plot()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: &gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_notebooks_basic_example_9_1.png" src="../../_images/examples_notebooks_basic_example_9_1.png" />
</div>
</div>
<p>Next, we try to compute the river elevation profile. This will fail because we have not yet downloaded MERIT data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
rpo.elev_profile(dist_to_walk_km=5)
</pre></div>
</div>
</div>
<p>If you’d like to complete this task, you will need to download the MERIT tile <code class="docutils literal notranslate"><span class="pre">n30w150</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># we can use rabpro.utils.coords_to_merit_tile to identify the correct tile name
rabpro.utils.coords_to_merit_tile(coords[1], coords[0])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;n30w90&#39;
</pre></div></div>
</div>
<p>Detailed instructions, including how to get a username and password for MERIT-Hydro downloads, are <a class="reference external" href="https://github.com/VeinsOfTheEarth/rabpro/blob/main/docs/source/examples/notebooks/downloading_data.ipynb">here</a>. Note that the MERIT tile will consume ~1.6 GB of space when unzipped.</p>
<p><code class="docutils literal notranslate"><span class="pre">download_merit_hydro()</span></code> will automatically rebuild virtual rasters, which are how rabpro interacts with the individual geotiffs, after downloading a tile.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rabpro</span> <span class="kn">import</span> <span class="n">data_utils</span>
<span class="n">data_utils</span><span class="o">.</span><span class="n">download_merit_hydro</span><span class="p">(</span><span class="s1">&#39;n30w90&#39;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">your_merit_username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">your_merit_password</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can try again:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>rpo.elev_profile(dist_to_walk_km=5)
plt.plot(rpo.flowline[&#39;Distance (m)&#39;], rpo.flowline[&#39;Elevation (m)&#39;])
plt.xlabel(&#39;Along-stream distance, m&#39;)
plt.ylabel(&#39;Elevation&#39;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Extracting flowpath from DEM...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;Elevation&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_notebooks_basic_example_17_2.png" src="../../_images/examples_notebooks_basic_example_17_2.png" />
</div>
</div>
<p>The along-stream distance is with respect to the provided coordinate. You can use the <code class="docutils literal notranslate"><span class="pre">rpo.flowline</span></code> GeoDataFrame to compute slopes.</p>
<p>You can export the <code class="docutils literal notranslate"><span class="pre">watershed</span></code> GeoDataFrame and/or the <code class="docutils literal notranslate"><span class="pre">flowline</span></code> GeoDataFrame using the <code class="docutils literal notranslate"><span class="pre">.export()</span></code> method.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
rpo.paths
rpo.export(&quot;all&quot;)
</pre></div>
</div>
</div>
<p>Once the subbasins are delinated, rabpro can use Google Earth Engine (GEE) to compute statistics for each subbasin. Using Google Earth Engine reduces the need to store large datasets locally, and speeds up computation by using GEE’s parallel distributed computing capabilities.</p>
<p>Note: In order to use rabpro for basin statistics, you’ll need to sign up for a GEE account. See rabpro’s documentation for more information.</p>
<p>Before we compute basin statistics, we’ll need to “build” our vector asset and upload it to GEE. This can be done either (1) manually through the GEE code editor, but you must first export as a shapefile, or (2) via <code class="docutils literal notranslate"><span class="pre">rabpro</span></code> automation. This automation requires that you have a writeable Google Cloud Platform (GCP) bucket and that you are authenticated via the command-line to call the <code class="docutils literal notranslate"><span class="pre">gsutil</span></code> and <code class="docutils literal notranslate"><span class="pre">earthengine</span></code> programs. These programs enable sending files to GCP and onward to GEE
respectively.</p>
<p>For now, you can skip this step as we’ve uploaded a demonstration file as a public asset. However, for instructions on uploading your shapefile as a GEE asset, see <a class="reference external" href="https://developers.google.com/earth-engine/cloud/assets#uploading-assets">this page</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">gcp_bucket</span> <span class="o">=</span> <span class="s2">&quot;your_gcp_bucket&quot;</span>
<span class="n">gee_user</span> <span class="o">=</span> <span class="s2">&quot;your_gee_username&quot;</span>
<span class="n">zip_path</span> <span class="o">=</span> <span class="n">rabpro</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_gee_vector_asset</span><span class="p">(</span><span class="n">rpo</span><span class="o">.</span><span class="n">watershed</span><span class="p">,</span> <span class="s2">&quot;rpo_basic.zip&quot;</span><span class="p">)</span>
<span class="n">your_gee_asset</span> <span class="o">=</span> <span class="n">rabpro</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">upload_gee_vector_asset</span><span class="p">(</span>
    <span class="n">zip_path</span><span class="p">,</span> <span class="n">gee_user</span><span class="p">,</span> <span class="n">gcp_bucket</span><span class="p">,</span> <span class="n">gcp_folder</span><span class="o">=</span><span class="s2">&quot;rabpro&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import ee
ee.Initialize()

# Specify which statistics to calculate for the JRC/GSW1_4/GlobalSurfaceWater dataset&#39;s occurrence band
statlist = [&#39;min&#39;]
data = rabpro.basin_stats.Dataset(&quot;JRC/GSW1_4/GlobalSurfaceWater&quot;, &quot;occurrence&quot;, stats=statlist)

d, t = rpo.basin_stats([data], gee_feature_path=&quot;users/jstacompute/rpo_basic&quot;, folder=&quot;rabpro test&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Submitting basin stats task to GEE for JRC/GSW1_4/GlobalSurfaceWater...
</pre></div></div>
</div>
<p>The output data will be placed in the <code class="docutils literal notranslate"><span class="pre">rabpro</span> <span class="pre">test</span></code> folder in your Google Drive if it already exists. If not, GEE will create a new <code class="docutils literal notranslate"><span class="pre">rabpro</span> <span class="pre">test</span></code> folder at the root level of your Drive.</p>
<p><code class="docutils literal notranslate"><span class="pre">basin_stats</span></code> returns a url to the resulting csv data which can be read directly with <code class="docutils literal notranslate"><span class="pre">pandas</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(d)
rabpro.basin_stats.fetch_gee(d, prepend_list=[&quot;basic&quot;]).head()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/tables/54699a14f7de869132ae860e0ec897b6-2228eb5923743f5c93511c0327985ddb:getFeatures&#39;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>basic_system:index</th>
      <th>basic_mean</th>
      <th>basic_min</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0_00000000000000000000</td>
      <td>83.323821</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="downloading_data.html" class="btn btn-neutral float-left" title="Downloading data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="multiple_basins.html" class="btn btn-neutral float-right" title="Multiple basins" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, J. Schwenk, J. Stachelek, T. Zussman, &amp; J. Rowland.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>