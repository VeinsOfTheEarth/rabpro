<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Basin stats examples &mdash; rabpro  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-dropdown.css?v=995e94df" />
      <link rel="stylesheet" type="text/css" href="../../_static/panels-bootstrap.min.css?v=21c0b90a" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=f3cb8367" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Contributing" href="../../contributing/index.html" />
    <link rel="prev" title="Multiple basins" href="multiple_basins.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            rabpro
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Setup:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configure/index.html">Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="downloading_data.html">Downloading data</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_example.html">Basic example</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiple_basins.html">Multiple basins</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Basin stats examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Categorical-asset---a-single-time-window">Categorical asset - a single time window</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Numeric-asset---multiple-time-windows">Numeric asset - multiple time windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Numeric-asset---time-averaging">Numeric asset - time averaging</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellanea:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../issues/index.html">Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../references/index.html">Citing rabpro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apiref/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">rabpro</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Basin stats examples</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Basin-stats-examples">
<h1>Basin stats examples<a class="headerlink" href="#Basin-stats-examples" title="Link to this heading"></a></h1>
<p>Generating basin stats from Earth Engine imagery is challenged by the many different ways in which image assets are stored and organized on the platform. As such, we have tried to strike a balance with <code class="docutils literal notranslate"><span class="pre">rabpro</span></code> between ease of use (abstracting away unncessary details) and flexibility. Before we begin pulling basin stats, lets create a basin polygon asset:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import pandas as pd
import geopandas as gpd

import rabpro
from rabpro.basin_stats import Dataset
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># # Authenticate earthengine if necessary
import ee
# ee.Authenticate()
ee.Initialize()
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
coords = (44.9331, -69.4996)
rpo = rabpro.profiler(coords, name=&#39;basic_test&#39;)
rpo.delineate_basin()
gdf = rpo.watershed
</pre></div>
</div>
</div>
<p>The next several examples pull from imagery assets that are within the standard GEE data catalog (<a class="reference external" href="https://developers.google.com/earth-engine/datasets/">https://developers.google.com/earth-engine/datasets/</a>). This simplifies their queries as we (typically) do not need to specify projection or resolution information. These are read directly from the catalog:</p>
<section id="Categorical-asset---a-single-time-window">
<h2>Categorical asset - a single time window<a class="headerlink" href="#Categorical-asset---a-single-time-window" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>urls, tasks = rabpro.basin_stats.compute(
        [Dataset(&quot;MODIS/006/MCD12Q1&quot;, &quot;LC_Type1&quot;, stats=[&quot;freqhist&quot;], start=&quot;2010-01-01&quot;, end=&quot;2011-01-01&quot;)],
        validate_dataset_list=False,
        gee_feature_path=&quot;users/jstacompute/rpo_basic&quot;
    )
data = rabpro.basin_stats.fetch_gee(urls, [&quot;lulc&quot;], [&quot;system:index&quot;])
res = gpd.GeoDataFrame(pd.concat([data, gdf], axis=1))
res.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lulc_1</th>
      <th>lulc_17</th>
      <th>lulc_4</th>
      <th>lulc_5</th>
      <th>lulc_8</th>
      <th>da_km2</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.87451</td>
      <td>16.337255</td>
      <td>621.25098</td>
      <td>1143.831373</td>
      <td>262.792157</td>
      <td>440.266532</td>
      <td>POLYGON ((-69.49583 44.92500, -69.50417 44.92500, -69.50502 44.92832, -69.50833 44.92917, -69.54...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Numeric-asset---multiple-time-windows">
<h2>Numeric asset - multiple time windows<a class="headerlink" href="#Numeric-asset---multiple-time-windows" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>urls, tasks = rabpro.basin_stats.compute(
        [Dataset(&quot;MODIS/006/MOD17A3HGF&quot;, &quot;Npp&quot;)],
        validate_dataset_list=False,
        gee_feature_path=&quot;users/jstacompute/rpo_basic&quot;
    )
data = rabpro.basin_stats.fetch_gee(urls, [&quot;npp&quot;], [&quot;da_km2&quot;])
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>data[&quot;year&quot;] = [x for x in range(2000, 2000 + data.shape[0])]
res = gpd.GeoDataFrame(pd.concat([data, gdf], axis=1))
res.geometry[res.geometry.isna()] = res.geometry[0]
res.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>npp_system:index</th>
      <th>npp_mean</th>
      <th>year</th>
      <th>da_km2</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2000_02_18_00000000000000000000</td>
      <td>7436.137468</td>
      <td>2000</td>
      <td>440.266532</td>
      <td>POLYGON ((-69.49583 44.92500, -69.50417 44.92500, -69.50502 44.92832, -69.50833 44.92917, -69.54...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2001_01_01_00000000000000000000</td>
      <td>7253.867450</td>
      <td>2001</td>
      <td>NaN</td>
      <td>POLYGON ((-69.49583 44.92500, -69.50417 44.92500, -69.50502 44.92832, -69.50833 44.92917, -69.54...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2002_01_01_00000000000000000000</td>
      <td>6741.378228</td>
      <td>2002</td>
      <td>NaN</td>
      <td>POLYGON ((-69.49583 44.92500, -69.50417 44.92500, -69.50502 44.92832, -69.50833 44.92917, -69.54...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2003_01_01_00000000000000000000</td>
      <td>6565.773486</td>
      <td>2003</td>
      <td>NaN</td>
      <td>POLYGON ((-69.49583 44.92500, -69.50417 44.92500, -69.50502 44.92832, -69.50833 44.92917, -69.54...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2004_01_01_00000000000000000000</td>
      <td>7645.184775</td>
      <td>2004</td>
      <td>NaN</td>
      <td>POLYGON ((-69.49583 44.92500, -69.50417 44.92500, -69.50502 44.92832, -69.50833 44.92917, -69.54...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Numeric-asset---time-averaging">
<h2>Numeric asset - time averaging<a class="headerlink" href="#Numeric-asset---time-averaging" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>urls, tasks = rabpro.basin_stats.compute(
        [Dataset(&quot;MODIS/061/MOD17A3HGF&quot;, &quot;Npp&quot;, time_stats=[&quot;median&quot;])],
        gee_feature_path=&quot;users/jstacompute/rpo_basic&quot;
    )
data = rabpro.basin_stats.fetch_gee(urls, [&quot;npp&quot;], [&quot;system:index&quot;])
res = gpd.GeoDataFrame(pd.concat([data, gdf], axis=1))
res.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>npp_mean</th>
      <th>da_km2</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7238.642484</td>
      <td>440.266532</td>
      <td>POLYGON ((-69.49583 44.92500, -69.50417 44.92500, -69.50502 44.92832, -69.50833 44.92917, -69.54...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The final example here demonstates a query of a “custom” imagery asset which is not present in the GEE data catalog. As a result, we must specify additional information to the <code class="docutils literal notranslate"><span class="pre">compute</span></code> function:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>urls, tasks = rabpro.basin_stats.compute(
        [Dataset(&quot;projects/soilgrids-isric/soc_mean&quot;, &quot;soc_0-5cm_mean&quot;, gee_type=&quot;image&quot;)],
        validate_dataset_list=False,
        gee_feature_path=&quot;users/jstacompute/rpo_basic&quot;
    )
data = rabpro.basin_stats.fetch_gee(urls, [&quot;soc5&quot;], [&quot;system:index&quot;])
res = gpd.GeoDataFrame(pd.concat([data, gdf], axis=1))
res.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>soc5_mean</th>
      <th>da_km2</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2407.976065</td>
      <td>440.266532</td>
      <td>POLYGON ((-69.49583 44.92500, -69.50417 44.92500, -69.50502 44.92832, -69.50833 44.92917, -69.54...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="multiple_basins.html" class="btn btn-neutral float-left" title="Multiple basins" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../contributing/index.html" class="btn btn-neutral float-right" title="Contributing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, J. Schwenk, J. Stachelek, T. Zussman, &amp; J. Rowland.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>